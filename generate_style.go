//go:build ignore
// +build ignore

package main

import (
	"bytes"
	"go/format"
	"html/template"
	"os"
	"strings"

	"golang.org/x/text/cases"
	"golang.org/x/text/language"
)

const tmpl = `// Code generated by generate_style.go; DO NOT EDIT.
package textstyle
const ({{range .}}
    {{.Label}}_LOWER_OFFSET = {{printf "%d" .LowerOffset}}
    {{.Label}}_UPPER_OFFSET = {{printf "%d" .UpperOffset}}
    {{.Label}}_DIGIT_OFFSET = {{printf "%d" .DigitOffset}}{{end}}
)
{{range .}}
func {{.TitleLabel}}() *Transformer{
    return NewTransformer(
        NewSimpleReplacer(
            "{{.TitleLabel}}",
            {{.Label}}_LOWER_OFFSET,
            {{.Label}}_UPPER_OFFSET,
            {{.Label}}_DIGIT_OFFSET,
        ),
    )
}
{{end}}`

type Style struct {
	Label       string
	TitleLabel  string
	LowerOffset rune
	UpperOffset rune
	DigitOffset rune
}

// edit here to add some styles with simpleReplacer.
// Label could contain space, but it is transformed as below.
// Style.Label => All upper case with underscore
// Style.TitleLabel => Title case with no space
var Styles = []Style{
	NewStyle("bold", "ðšð€ðŸŽ"),
	NewStyle("italic", "ð‘Žð´0"),
	NewStyle("sans serif", "ð–ºð– ðŸ¢"),
	NewStyle("bold italic", "ð’‚ð‘¨ðŸŽ"),
	NewStyle("script", "ð’¶ð’œ0"),
	NewStyle("bold script", "ð“ªð“ðŸŽ"),
	NewStyle("fraktur", "ð”žð”„0"),
	NewStyle("bold fraktur", "ð–†ð•¬ðŸŽ"),
	NewStyle("double struck", "ð•’ð”¸ðŸ˜"),
	NewStyle("sans serif", "ð–ºð– ðŸ¢"),
	NewStyle("sans serif bold", "ð—®ð—”ðŸ¬"),
	NewStyle("sans serif italic", "ð˜¢ð˜ˆðŸ¢"),
	NewStyle("sans serif bold italic", "ð™–ð˜¼ðŸ¬"),
	NewStyle("monospace", "ðšŠð™°ðŸ¬"),
}

// replacePattern must be aA0 with a specific text style.
func NewStyle(label string, replacePattern string) Style {
	ss := make([]rune, 3)
	var n int
	for _, r := range replacePattern {
		if n > 2 {
			panic("argument `replace` must be each text style's aA0")
		}
		ss[n] = r
		n++
	}
	if n != 3 {
		panic("argument `replace` must be each text style's aA0")
	}
	s := Style{
		toLabel(label),
		toTitleLabel(label),
		ss[0] - 'a',
		ss[1] - 'A',
		ss[2] - '0',
	}
	return s
}

func toLabel(s string) string {
	// replace space by underscore
	ss := strings.Replace(s, " ", "_", -1)
	return strings.ToUpper(ss)
}

func toTitleLabel(s string) string {
	// transform into title case, then remove space
	c := cases.Title(language.English)
	ss := c.String(s)
	return strings.Replace(ss, " ", "", -1)
}

func main() {
	t := template.Must(template.New("style").Parse(tmpl))
	f, err := os.Create("styles.go")
	if err != nil {
		panic(err)
	}
	defer f.Close()

	buf := new(bytes.Buffer)
	if err := t.Execute(buf, Styles); err != nil {
		panic(err)
	}
	formatted, err := format.Source(buf.Bytes())
	if err != nil {
		panic(err)
	}
	_, err = f.Write(formatted)
	if err != nil {
		panic(err)
	}
}
